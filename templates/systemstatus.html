{% extends "base.html" %}
{% block content %}
<h2 class="text-2xl font-bold mb-6">ğŸ§  Systemstatus</h2>

<!-- SYSTEMINFOS -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
  <div class="bg-white rounded-xl p-4 shadow">
    <h3 class="font-semibold mb-2">ğŸ’» System</h3>
    <p><b>Hostname:</b> {{ sys.hostname }}</p>
    <p><b>OS:</b> {{ sys.os }}</p>
    <p><b>Uptime:</b> {{ sys.uptime }}</p>
  </div>

  <div class="bg-white rounded-xl p-4 shadow">
    <h3 class="font-semibold mb-2">ğŸŒ Netzwerk</h3>
    <p><b>IP-Adresse:</b> {{ sys.ip }}</p>
    <p><b>WLAN:</b> {{ sys.wifi }}</p>
  </div>

  <div class="bg-white rounded-xl p-4 shadow">
    <h3 class="font-semibold mb-2">ğŸ”¥ CPU</h3>
    <p><b>Last:</b> {{ sys.cpu }} %</p>
    <p><b>Temperatur:</b> {{ sys.temp }} Â°C</p>
  </div>

  <div class="bg-white rounded-xl p-4 shadow">
    <h3 class="font-semibold mb-2">ğŸ§  RAM</h3>
    <p>{{ sys.ram_used }} / {{ sys.ram_total }} MB</p>
  </div>

  <div class="bg-white rounded-xl p-4 shadow md:col-span-2">
    <h3 class="font-semibold mb-2">ğŸ’¾ Speicher</h3>
    <p>{{ sys.disk_used }} / {{ sys.disk_total }} GB ({{ sys.disk_percent }}%)</p>
    <div class="w-full bg-gray-200 rounded h-3 mt-2">
      <div style="width: {{ sys.disk_percent }}%;" class="bg-blue-600 h-3 rounded"></div>
    </div>
  </div>

  {% if zte %}
  <div class="bg-white rounded-xl p-4 shadow md:col-span-2">
    <h3 class="font-semibold mb-2">ğŸ“¡ ZTE Modem</h3>
    <p><b>Status:</b> {{ "online" if zte.online else "offline" }}{% if zte.last_poll_human %} (letzter Poll: {{ zte.last_poll_human }}){% endif %}</p>
    {% if zte.latest %}
      <p><b>WAN IP:</b> {{ zte.latest.wan_ipaddr or "-" }} | <b>RSRP:</b> {{ zte.latest.lte_rsrp or "-" }} | <b>SNR:</b> {{ zte.latest.lte_snr or "-" }}</p>
    {% endif %}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-3">
      <div class="bg-gray-50 rounded p-3">
        <div class="text-sm text-gray-500">Heute</div>
        <div class="text-xl font-semibold">{{ zte.today_mb }} MB</div>
      </div>
      <div class="bg-gray-50 rounded p-3">
        <div class="text-sm text-gray-500">Diese Woche</div>
        <div class="text-xl font-semibold">{{ zte.week_mb }} MB</div>
      </div>
      <div class="bg-gray-50 rounded p-3">
        <div class="text-sm text-gray-500">Aktueller Zyklus</div>
        <div class="text-xl font-semibold">{{ zte.cycle_mb }} MB</div>
      </div>
    </div>
    {% if zte.history %}
    <div class="mt-4">
      <h4 class="font-semibold mb-1">Letzte Tage</h4>
      <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
        {% for entry in zte.history %}
        <div class="bg-white border rounded p-2 text-sm">
          <div class="text-gray-500">{{ entry.day }}</div>
          <div class="font-semibold">{{ (entry.bytes / (1024*1024)) | round(2) }} MB</div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    {% if zte.error %}
      <p class="text-red-600 mt-2">Fehler beim Lesen der Modemdaten: {{ zte.error }}</p>
    {% endif %}
  </div>
  {% endif %}
</div>

<!-- WLAN KONFIG -->
<div class="bg-white rounded-xl p-4 shadow mb-6">
  <h3 class="font-semibold mb-2">ğŸ“¶ WLAN-Konfiguration</h3>
  <form id="wifiForm" class="space-y-4">
    <div>
      <label class="font-semibold">SSID auswÃ¤hlen</label>
      <select name="ssid" class="border p-2 rounded w-full">
        {% for net in sys.networks %}
          <option value="{{ net.ssid }}">{{ net.ssid }} (Signal: {{ net.signal }}%)</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="font-semibold">Kennwort</label>
      <input type="password" name="psk" class="border p-2 rounded w-full">
    </div>
    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded w-full">ğŸ’¾ Verbinden</button>
  </form>
  <p id="msg" class="text-center mt-4 hidden text-green-600"></p>
</div>

<script>
document.getElementById('wifiForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const res = await fetch('/wifi/configure', { method: 'POST', body: formData });
  const data = await res.json();
  const msg = document.getElementById('msg');
  msg.innerText = data.message;
  msg.classList.remove('hidden');
  if(data.status === 'ok') msg.classList.add('text-green-600');
  else msg.classList.add('text-red-600');
});
</script>

{% endblock %}
