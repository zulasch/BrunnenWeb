{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-bold mb-6">ğŸ“Š Messsystem-Konfiguration</h1>

<div id="messageBox" class="hidden mb-4"></div>

<form id="configForm" onsubmit="saveConfig(event)" class="bg-white p-6 rounded-xl shadow space-y-4">

<!-- Globale Einstellungen -->
<div class="bg-white p-6 rounded-xl shadow mb-6">
  <h2 class="text-xl font-bold mb-4">âš™ï¸ Allgemeine Einstellungen</h2>
  {% for key, val in config.items() %}
    {% if key in ["MESSINTERVAL", "ADMIN_PIN"] %}
      <div class="mb-4">
        <label class="block font-semibold text-gray-700 mb-1">{{ key }}</label>
        <input name="{{ key }}" value="{{ val }}" class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 outline-none" />
        <p class="text-gray-500 text-sm mt-1">{{ descriptions.get(key) }}</p>
      </div>
    {% endif %}
  {% endfor %}
</div>

<!-- KanÃ¤le -->
{% set colors = ["bg-blue-50", "bg-green-50", "bg-yellow-50", "bg-purple-50"] %}
{% for channel in ["A0", "A1", "A2", "A3"] %}
  <div class="{{ colors[loop.index0] }} border p-6 rounded-xl shadow mb-6">
    <h2 class="text-xl font-bold mb-4">ğŸ’§ Kanal {{ channel }} â€“ {{ config.get("NAME_" + channel, "unbenannt") }}</h2>

    {% for key, val in config.items() %}
      {% if key.endswith("_" + channel) %}
        <div class="mb-4">
          <label class="block font-semibold text-gray-700 mb-1">{{ key }}</label>
          <input name="{{ key }}" value="{{ val }}" class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 outline-none" />
          <p class="text-gray-500 text-sm mt-1">{{ descriptions.get(key) }}</p>
        </div>
      {% endif %}
    {% endfor %}
  </div>
{% endfor %}


  <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
    ğŸ’¾ Ã„nderungen speichern
  </button>
</form>

<script>
async function saveConfig(event) {
  event.preventDefault();

  const form = document.getElementById('configForm');
  const formData = new FormData(form);
  const box = document.getElementById("messageBox");

  try {
    const response = await fetch('{{ url_for("update_config") }}', { method: 'POST', body: formData });
    const result = await response.json();

    box.classList.remove("hidden");
    box.textContent = result.message;
    box.className = result.success
      ? "p-3 rounded bg-green-100 text-green-800 border border-green-400"
      : "p-3 rounded bg-red-100 text-red-800 border border-red-400";
	// ğŸ‘‡ Nach oben scrollen nach erfolgreichem Speichern
    window.scrollTo({ top: 0, behavior: "smooth" });
  } catch (err) {
    box.classList.remove("hidden");
    box.textContent = "âŒ Netzwerkfehler oder Serverproblem: " + err;
    box.className = "p-3 rounded bg-red-100 text-red-800 border border-red-400";
	// ğŸ‘‡ Auch bei Fehler nach oben scrollen
    window.scrollTo({ top: 0, behavior: "smooth" });
  }
}
</script>
{% endblock %}
