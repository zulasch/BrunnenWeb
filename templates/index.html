{% extends "base.html" %}
{% block content %}
<h2 class="text-xl font-bold mb-4">ğŸ“Š Messsystem-Konfiguration</h2>

<div id="messageBox" class="hidden"></div>

<form id="configForm" onsubmit="saveConfig(event)">
  <!-- deine Eingabefelder -->
  <button type="submit" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
    ğŸ’¾ Speichern
  </button>
</form>

<form id="configForm" class="space-y-4">
  {% for key, value in config.items() %}
    <div>
      <label class="font-semibold">{{ key }}</label>
      <small class="block text-gray-500 mb-1">{{ descriptions.get(key, '') }}</small>
      <input type="text" name="{{ key }}" value="{{ value }}"
             class="border p-2 rounded w-full"
             title="{{ descriptions.get(key, '') }}">
    </div>
  {% endfor %}
  <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full">
    ğŸ’¾ Speichern
  </button>
</form>
<p id="msg" class="text-center text-green-600 mt-4 hidden">Gespeichert!</p>

<script>
async function saveConfig(event) {
  event.preventDefault();
  const form = document.getElementById('configForm');
  const formData = new FormData(form);

  try {
    const response = await fetch('{{ url_for("update_config") }}', {
      method: 'POST',
      body: formData
    });
    const result = await response.json();

    // Ergebnis anzeigen
    const msgBox = document.getElementById("messageBox");
    msgBox.classList.remove("hidden");
    msgBox.textContent = result.message;

    if (result.success) {
      msgBox.className = "p-3 mb-4 rounded bg-green-200 text-green-800";
    } else {
      msgBox.className = "p-3 mb-4 rounded bg-red-200 text-red-800";
    }

  } catch (error) {
    const msgBox = document.getElementById("messageBox");
    msgBox.classList.remove("hidden");
    msgBox.textContent = "âŒ Netzwerkfehler beim Speichern!";
    msgBox.className = "p-3 mb-4 rounded bg-red-200 text-red-800";
  }
}
</script>
{% endblock %}


