{% extends "base.html" %}
{% block content %}
<h2 class="text-xl font-bold mb-4">⚙️ Dienstverwaltung</h2>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
  <div class="bg-white p-5 shadow rounded-xl">
    <h3 class="font-semibold text-lg mb-2">📘 Logger-Dienst</h3>
    <p class="text-gray-600 mb-3">Erfasst und speichert aktuelle Messwerte.</p>
    <button id="restart-logger" class="bg-blue-600 text-white px-4 py-3 rounded-xl hover:bg-blue-700 w-full">🔁 Logger neu starten</button>
  </div>

  <div class="bg-white p-5 shadow rounded-xl">
    <h3 class="font-semibold text-lg mb-2">💻 WebApp-Dienst</h3>
    <p class="text-gray-600 mb-3">Steuert das Webinterface und die Benutzeroberfläche.</p>
    <button id="restart-web" class="bg-green-600 text-white px-4 py-3 rounded-xl hover:bg-green-700 w-full">🔄 WebApp neu starten</button>
  </div>

  <div class="bg-white p-5 shadow rounded-xl md:col-span-2">
    <h3 class="font-semibold text-lg mb-2">🌀 GitHub-Update</h3>
    <p class="text-gray-600 mb-3">Hole die neuesten Änderungen aus GitHub und aktualisiere automatisch.</p>
    <button id="updateBtn" class="bg-purple-600 text-white px-4 py-3 rounded-xl hover:bg-purple-700 w-full">⬆️ Update starten</button>
  </div>
</div>

<div id="service-result" class="mt-6 text-center"></div>
<div id="updateStatus" class="mt-4 p-3 rounded hidden"></div>

<script>
async function restartService(service) {
  const btn = document.getElementById(`restart-${service}`);
  const resultBox = document.getElementById("service-result");
  btn.disabled = true;
  btn.textContent = "⏳ Neustart läuft...";
  resultBox.innerHTML = "";

  try {
    const formData = new FormData();
    formData.append("service", service);
    formData.append("action", "restart");
    const response = await fetch("/service/action", { method: "POST", body: formData });
    const data = await response.json();
    resultBox.innerHTML = `<div class='${data.status === "ok" ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800"} p-3 rounded'>${data.message}</div>`;
  } catch (err) {
    resultBox.innerHTML = `<div class='bg-yellow-100 text-yellow-800 p-3 rounded'>⚠️ ${err}</div>`;
  } finally {
    btn.disabled = false;
    btn.textContent = service === "logger" ? "🔁 Logger neu starten" : "🔄 WebApp neu starten";
  }
}

document.getElementById("restart-logger").addEventListener("click", () => restartService("logger"));
document.getElementById("restart-web").addEventListener("click", () => restartService("web"));
</script>
{% endblock %}
