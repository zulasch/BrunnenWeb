{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-bold mb-4">âš™ï¸ Dienstverwaltung</h1>

<div class="space-y-4">
  <div class="bg-white p-4 shadow rounded">
    <h2 class="font-semibold mb-2">Logger-Dienst</h2>
    <button id="restart-logger" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      ğŸ” Logger neu starten
    </button>
  </div>

  <div class="bg-white p-4 shadow rounded">
    <h2 class="font-semibold mb-2">WebApp-Dienst</h2>
    <button id="restart-web" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
      ğŸ”„ WebApp neu starten
    </button>
  </div>
</div>

<div id="service-result" class="mt-6 text-center"></div>

<script>
async function restartService(service) {
  const btn = document.getElementById(`restart-${service}`);
  btn.disabled = true;
  btn.textContent = "â³ Neustart lÃ¤uft...";
  document.getElementById("service-result").innerHTML = "";

  try {
    const formData = new FormData();
    formData.append("service", service);
    formData.append("action", "restart");

    const response = await fetch("/service/action", { method: "POST", body: formData });
    const data = await response.json();

    if (response.ok && data.status === "ok") {
      document.getElementById("service-result").innerHTML =
        `<div class='bg-green-100 text-green-800 p-3 rounded'>${data.message}</div>`;
    } else {
      document.getElementById("service-result").innerHTML =
        `<div class='bg-red-100 text-red-800 p-3 rounded'>${data.message}</div>`;
    }
  } catch (err) {
    document.getElementById("service-result").innerHTML =
      `<div class='bg-red-100 text-red-800 p-3 rounded'>Netzwerkfehler: ${err}</div>`;
  } finally {
    btn.disabled = false;
    btn.textContent = service === "logger" ? "ğŸ” Logger neu starten" : "ğŸ”„ WebApp neu starten";
  }
}

document.getElementById("restart-logger").addEventListener("click", () => restartService("logger"));
document.getElementById("restart-web").addEventListener("click", () => restartService("web"));
</script>
{% endblock %}





<hr class="my-6">

<h2 class="text-lg font-semibold mb-2">ğŸŒ€ GitHub-Update</h2>
<p class="text-gray-700 mb-4">Hier kannst du dein Messsystem direkt aus deinem GitHub-Repository aktualisieren.</p>

<form id="updateForm" onsubmit="return false;">
  <button id="updateBtn"
          type="submit"
          class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
    ğŸ”„ Update starten
  </button>
</form>

<div id="updateStatus" class="mt-4 p-3 rounded hidden"></div>

<script>
document.getElementById("updateBtn").addEventListener("click", async () => {
  const statusBox = document.getElementById("updateStatus");
  const btn = document.getElementById("updateBtn");

  if (!confirm("âš™ï¸ MÃ¶chtest du wirklich ein GitHub-Update ausfÃ¼hren?")) return;

  btn.disabled = true;
  btn.innerText = "â³ Aktualisiere...";
  statusBox.className = "mt-4 p-3 rounded bg-yellow-100 text-gray-800";
  statusBox.innerText = "Update lÃ¤uft... bitte warten.";
  statusBox.classList.remove("hidden");

  try {
    const response = await fetch("/update-system", { method: "POST" });
    const data = await response.json();

    if (data.success) {
      statusBox.className = "mt-4 p-3 rounded bg-green-100 text-green-800 whitespace-pre-wrap";
      statusBox.innerText = "âœ… Update erfolgreich abgeschlossen:\n\n" + data.message;
    } else {
      statusBox.className = "mt-4 p-3 rounded bg-red-100 text-red-800 whitespace-pre-wrap";
      statusBox.innerText = "âŒ Fehler beim Update:\n\n" + (data.message || "Unbekannter Fehler");
    }
  } catch (err) {
    statusBox.className = "mt-4 p-3 rounded bg-red-100 text-red-800";
    statusBox.innerText = "âš ï¸ Netzwerkfehler oder Serverproblem: " + err;
  }

  btn.disabled = false;
  btn.innerText = "ğŸ”„ Update starten";
});
</script>
{% endblock %}


